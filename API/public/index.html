<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Painel de Jogos do Flamengo 2025</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

  <div class="container py-4">
    <h1 class="mb-4 text-center text-danger fw-bold">üìù Painel de Jogos do Flamengo 2025</h1>

    <div class="d-flex align-items-center gap-2">
      <label class="form-label mb-0" for="filtroCompeticao">Filtrar por competi√ß√£o:</label>
      <select class="form-select w-auto" id="filtroCompeticao">
        <option value="">Todas</option>
        <option value="brasileirao">Brasileir√£o</option>
        <option value="copa do brasil">Copa do Brasil</option>
        <option value="libertadores">Copa Libertadores da Am√©rica</option>
        <option value="super mundial">Super Mundial de Clubes</option>
      </select>
      <button class="btn btn-danger" onclick="carregarJogos()">Buscar</button>
    </div>

    <div class="table-responsive mt-4">
      <table class="table table-bordered table-hover align-middle">
        <thead class="table-danger text-center">
          <tr>
            <th>ID</th>
            <th>Data</th>
            <th>Hora</th>
            <th>Local</th>
            <th>Advers√°rio</th>
            <th>Competi√ß√£o</th>
            <th>Placar</th>
            <th>Etapa</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaJogos"></tbody>
      </table>
    </div>

    <div class="card mt-5">
      <div class="card-header bg-danger text-white">
        <h5 class="mb-0">‚ûï Adicionar novo jogo</h5>
      </div>
      <div class="card-body">
        <form id="formNovoJogo" class="row g-3">
          <div class="col-md-3">
            <label class="form-label">Data</label>
            <input type="date" class="form-control" id="data" required>
          </div>
          <div class="col-md-3">
            <label class="form-label">Hora</label>
            <input type="time" class="form-control" id="hora" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Local</label>
            <input type="text" class="form-control" id="local" placeholder="Local" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Advers√°rio</label>
            <input type="text" class="form-control" id="adversario" placeholder="Advers√°rio" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Competi√ß√£o</label>
            <select class="form-select" id="competicao" required>
              <option disabled selected>Escolha a competi√ß√£o</option>
              <option value="brasileirao">Brasileir√£o</option>
              <option value="copa do brasil">Copa do Brasil</option>
              <option value="libertadores">Copa Libertadores da Am√©rica</option>
              <option value="super mundial">Super Mundial de Clubes</option>
            </select>
          </div>
          <div class="col-12 text-end">
            <button type="submit" class="btn btn-success">Salvar Jogo</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:3000/jogos';

    function carregarJogos() {
      const filtro = document.getElementById('filtroCompeticao').value;
      const url = filtro ? `${API_URL}?competicao=${encodeURIComponent(filtro)}` : API_URL;

      fetch(url)
        .then(res => res.json())
        .then(jogos => {
          const tbody = document.getElementById('tabelaJogos');
          tbody.innerHTML = '';

          jogos.forEach(jogo => {
            const linha = document.createElement('tr');
            linha.innerHTML = `
              <td>${jogo.id}</td>
              <td>${jogo.data}</td>
              <td>${jogo.hora}</td>
              <td>${jogo.local}</td>
              <td>${jogo.adversario}</td>
              <td>${jogo.competicao}</td>              
              <td>${jogo.concluido ? `<strong>${jogo.gols_flamengo} x ${jogo.gols_adversario}</strong>` : 'A disputar'}</td>
              <td>${jogo.etapa}</td>
              <td class="d-flex gap-2 justify-content-center">
                <button class="btn btn-sm btn-warning" onclick="editarPlacar(${jogo.id}, '${jogo.competicao}')">Editar</button>
              </td>
            `;
            tbody.appendChild(linha);
          });
        });
    }

    function editarPlacar(id, competicao) {
      const golsFla = prompt("Quantos gols o Flamengo fez?");
      const golsAdv = prompt("Quantos gols o advers√°rio fez?");

      if (golsFla === null || golsAdv === null) return;

      const dados = {
        gols_flamengo: parseInt(golsFla),
        gols_adversario: parseInt(golsAdv),
        concluido: true
      };

      fetch(`${API_URL}/${id}?competicao=${encodeURIComponent(competicao)}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(dados)
      })
        .then(res => res.json())
        .then(() => {
          alert('Placar atualizado!');
          carregarJogos();
        });
    }

    document.getElementById('formNovoJogo').addEventListener('submit', e => {
      e.preventDefault();

      const novoJogo = {
        data: document.getElementById('data').value,
        hora: document.getElementById('hora').value,
        local: document.getElementById('local').value,
        adversario: document.getElementById('adversario').value,
        competicao: document.getElementById('competicao').value,
        concluido: false,
        gols_flamengo: null,
        gols_adversario: null,
        etapa: "fase de grupos"
      };

      fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(novoJogo)
      })
        .then(res => res.json())
        .then(() => {
          alert('Jogo adicionado!');
          carregarJogos();
          e.target.reset();
        });
    });

    window.onload = carregarJogos;
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
